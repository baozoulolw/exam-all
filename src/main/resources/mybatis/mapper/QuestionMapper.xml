<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd">
<mapper namespace = "top.baozoulolw.exam.dao.QuestionDao">
    <select id="getQuestionList" resultType="top.baozoulolw.exam.entity.Question"
            parameterType="top.baozoulolw.exam.vo.QuestionParamVO">
        select q.*, u.real_name as change_user from
        tb_question q ,tb_user u where u.id = q.oper_user
        <if test="param.type != null">
            AND q.type = #{param.type}
        </if>
        <if test="param.groupId != null">
            AND q.group_id = #{param.groupId}
        </if>
        <if test="param.hard != null">
            AND q.hard = #{param.hard}
        </if>
        <if test="param.keyword != null and param.keyword != ''">
            AND (q.options like "%"#{param.keyword}"%"
            OR q.answer like "%"#{param.keyword}"%"
            OR q.topic like "%"#{param.keyword}"%"
            )
        </if>
        <if test="param.selectPaperId != null and param.selectPaperId != ''">
            and q.id NOT IN (
            SELECT
            tqp.question_id
            FROM
            tb_question_paper tqp
            WHERE
            tqp.paper_id = #{param.selectPaperId} )
        </if>
    </select>
    <select id="getGroupList" resultType="top.baozoulolw.exam.entity.QuestionGroup">
        select qg.*,count(q.id) questionNumber from tb_question_group qg left join tb_question q  on q.group_id = qg.id
        group by qg.id
    </select>
</mapper>